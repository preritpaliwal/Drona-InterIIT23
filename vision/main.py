from kalman_filter_v2 import KalmanFilter
from QuadrotorDynamics import QuadrotorDynamics
import numpy as np
import time

sensor1_fake_data = np.array([[ 0.5401452871350632 , 0.799095657556752 , -0.6313748959445533 ] ,
[ -0.48484178976101266 , 0.557069502875498 , -2.824291779837566 ] ,
[ -0.06015329688363935 , 0.8735569711476798 , -6.8762112040796985 ] ,
[ 0.2383407468637735 , -0.1778394186280154 , -10.684944178924685 ] ,
[ 0.49569817919047554 , -0.2763887971830936 , -15.854718030617057 ] ,
[ -0.8278346558061447 , 0.6512360392517065 , -21.05740317984276 ] ,
[ -0.6486825406761784 , -0.14577836723880344 , -29.879943648097235 ] ,
[ -1.1084622655441088 , 0.4038926893216383 , -36.45660975236462 ] ,
[ -1.039455183211439 , 0.9421195119549208 , -45.016169761808264 ] ,
[ 0.31724986314106207 , 0.44426106268517224 , -55.49009530867628 ] ,
[ -0.5219286755802951 , 0.5361503060626958 , -67.89398323559091 ] ,
[ -0.8296716041785743 , 0.43460343836381937 , -78.71875750977475 ] ,
[ 0.24915466991306934 , 0.9984246167912854 , -91.33860841540931 ] ,
[ -0.1465422955979605 , -0.11660268742068722 , -105.63461569560236 ] ,
[ -1.051702623263915 , 0.5798339357465372 , -120.87086389176753 ] ,
[ -0.5547603878447123 , -0.20374643385302885 , -137.2679860505902 ] ,
[ -0.29976057915745524 , 0.6360336586069462 , -153.29695343204554 ] ,
[ 0.11354211452396346 , 0.7539603978033265 , -170.56701660809736 ] ,
[ -0.6612087618197546 , 0.6638102020979817 , -189.9499778665834 ] ,
[ 0.21758171255992398 , -0.16133553063996378 , -210.34885890901745 ] ,
[ -0.7621636336685305 , 0.6225630640704181 , -230.98796450515468 ] ,
[ -0.5543531730490698 , 0.3522363999955876 , -254.4862686928423 ] ,
[ -0.44802706107724144 , -0.09770381067922579 , -275.53875463333804 ] ,
[ 0.23445560981004987 , 0.5336535187921803 , -301.5617617694077 ] ,
[ 0.5614043732990182 , 0.31624268082058943 , -324.58889722737183 ] ,
[ 0.12735770583837924 , 0.6546632993388146 , -352.9617706218089 ] ,
[ -0.40125879755521454 , 0.5494877512194649 , -378.39877884658745 ] ,
[ -0.5178143275530166 , 0.3136065417478176 , -407.9699282789889 ] ,
[ 0.12505955876456065 , 0.34982392277239954 , -436.6579012689362 ] ,
[ -1.114731526166585 , 0.3949768292744518 , -466.8482662382424 ] ,
[ -1.1449103305032415 , 0.30424646426262664 , -496.75299486033254 ] ,
[ -0.5192591934757771 , 0.04976438615175638 , -529.7251225781399 ] ,
[ -1.1236053016538283 , 0.06818707148927028 , -560.5152281960495 ] ,
[ 0.6600770277509345 , -0.16808865266441386 , -594.8292024273443 ] ,
[ 0.055264060191596576 , -0.10134165091520264 , -631.52088342586 ] ,
[ -0.7113447164079342 , -0.03187667782993803 , -667.8867846620084 ] ,
[ -0.8415647780730724 , 0.9041678775519215 , -704.6501878476469 ] ,
[ -0.29775817018706086 , 0.04755516771516394 , -742.4579594488667 ] ,
[ -0.21078155910156193 , 0.3775592012917239 , -780.4782373844736 ] ,
[ 0.1308034586905178 , 0.5647376559003701 , -819.8912331028059 ] ,
[ 0.14441121993274741 , 0.07437479650733497 , -861.1435927278477 ] ,
[ 0.6536629150260813 , 0.5073635687286993 , -904.6937873316834 ] ,
[ -0.5963144415900175 , 0.3859825135703924 , -947.9214155504035 ] ,
[ -0.8270249160532697 , -0.14835981633926523 , -991.3781871473677 ] ,
[ -0.07376622316691739 , -0.10572804814296735 , -1036.1858246560082 ] ,
[ -0.7764319238414084 , 0.35924367985577105 , -1082.9799521449518 ] ,
[ -0.4634137369294328 , 0.9537077505286298 , -1127.8646262269128 ] ,
[ -0.7638601054822978 , 0.7311115374666832 , -1176.018305093479 ] ,
[ 0.031933997815183135 , 0.36363377955683834 , -1225.6192781253267 ] ,
[ -0.8561294863737903 , -0.19124377519628527 , -1276.6343971546085 ] ,
[ -0.5370765920842098 , -0.12005496950208447 , -1325.9808986495837 ] ,
[ -1.0913192541779912 , 0.16492877343131668 , -1377.6624415250242 ] ,
[ -0.9956002436745697 , 0.12536699356968917 , -1430.925994337983 ] ,
[ 0.15119958444424486 , 0.8039738759992718 , -1486.3652542457492 ] ,
[ 0.3601260865839937 , 0.7229498738999718 , -1541.9880565706012 ] ,
[ -1.0573086163143453 , -0.1328666837743797 , -1597.5144581628592 ] ,
[ -1.1953874325980733 , -0.19304029879746828 , -1653.4073525967488 ] ,
[ -0.6247419483472578 , -0.04507042006653866 , -1711.4882652073418 ] ,
[ -0.7583651704213088 , 0.2504730939273601 , -1770.6276495660888 ] ,
[ -0.03425608814237968 , -0.0361482694561448 , -1831.4289435040534 ] ,
[ -0.38322468650047925 , 0.026694070869777153 , -1890.7167574580205 ] ,
[ 0.13588136071124723 , 0.1302169998194206 , -1952.6239640502667 ] ,
[ -0.39212858008438556 , 0.3382950977627353 , -2016.008772184802 ] ,
[ -0.8150181130082643 , 0.65419524640787 , -2081.411240000379 ] ,
[ -0.13710215233254863 , 0.11766868950893244 , -2145.188341274184 ] ,
[ -0.4809106456139913 , -0.07697616551951397 , -2212.5199183057252 ] ,
[ 0.2679153477407512 , 0.2083646998766498 , -2279.4474560666604 ] ,
[ 0.5656627095029378 , -0.25378836784316544 , -2347.288974604383 ] ,
[ -0.12800009147814628 , 0.8171776609111552 , -2416.4285945140746 ] ,
[ 0.41424795085977983 , 0.9563165475317599 , -2485.605921898648 ] ,
[ 0.6220818971582931 , 0.9497702005430262 , -2556.2581568459336 ] ,
[ 0.17863778868360392 , 0.8611601811860898 , -2629.0606066183973 ] ,
[ -0.057087040262479016 , -0.2820403195503879 , -2701.383167830445 ] ,
[ -1.0815510928941814 , -0.08334800992846297 , -2776.0387454319334 ] ,
[ -1.1656627531680388 , 0.5723694096713459 , -2849.8514663522005 ] ,
[ -0.17602309228762403 , 0.8635222868526191 , -2925.6865917167042 ] ,
[ -1.110466106772522 , 0.07058234906534688 , -3004.6593145805045 ] ,
[ -0.18327357052047644 , -0.23605988532955927 , -3081.7168220927497 ] ,
[ 0.17692310588190008 , 0.7296109791156076 , -3159.7112339652545 ] ,
[ 0.2185824347243397 , -0.24658916642691298 , -3240.767336938291 ] ,
[ -0.7762150753154171 , -0.17797105745433162 , -3322.5267464004437 ] ,
[ 0.1974668032779574 , 0.24691000220065268 , -3402.7569486010702 ] ,
[ -1.1631529440841886 , 0.6104675741982399 , -3485.5520494871826 ] ,
[ 0.5017036654925842 , 0.02910595775214747 , -3569.5605888502137 ] ,
[ 0.09389366112401842 , 0.8824856307662783 , -3654.884160160819 ] ,
[ 0.34259545599583663 , 0.9152795341479703 , -3742.7531562313425 ] ,
[ 0.3895857291427196 , 0.8407407610425914 , -3827.5574522323686 ] ,
[ -0.28373856782671236 , 0.7202379643092072 , -3916.4741766671214 ] ,
[ -0.823170028128656 , 0.5436462050037585 , -4006.943425460532 ] ,
[ 0.08149985394224735 , 0.9632923033100249 , -4096.3750345402805 ] ,
[ 0.2353359129887953 , -0.2955781961543395 , -4186.259748996409 ] ,
[ -0.3282540900999831 , -0.06725278962703668 , -4278.046968658812 ] ,
[ -0.5736104495142883 , 0.7901032727924133 , -4371.679387000753 ] ,
[ 0.5912864692117843 , 0.9830005163076891 , -4464.953752916104 ] ,
[ -0.3678724640812413 , 0.7091063567978924 , -4561.107058165993 ] ,
[ 0.25349007053535 , 0.8831115587536018 , -4656.0469063761875 ] ,
[ -0.467755445806336 , 0.13891760214300192 , -4754.133259411922 ] ,
[ -0.8155717187575009 , 0.0413770877155204 , -4851.270371093714 ] ,
[ -1.1244411986084946 , 0.3173505070540022 , -4949.885818419069 ] ,
[ 0.6113631786187974 , -0.038180581987897644 , -5050.858861145448 ]])

sensor2_fake_data = np.array([[ 0.2612939765849027 , 0.9684902440253361 , -3.3104954715688137 ] ,
[ -0.40177247591375953 , 0.2540176327476482 , -5.3784122322302945 ] ,
[ -1.0693100005389315 , 0.637731892749201 , -6.195039877587728 ] ,
[ 1.4499595780661225 , 0.4369102622124764 , -10.395660274815576 ] ,
[ 0.9574736515659137 , 1.5013444970659875 , -16.944665318975535 ] ,
[ 1.229075299262733 , 1.2629739354191485 , -22.623172023732405 ] ,
[ -0.038923506301462574 , 1.1178969072098919 , -29.558491507601165 ] ,
[ 0.6109642776823685 , 0.10661858511293756 , -37.57974115894713 ] ,
[ 1.2055614325817696 , 0.1126717305066178 , -46.6586025807524 ] ,
[ 1.3117883228446499 , 1.27328427892654 , -55.576262184653835 ] ,
[ 0.32376756569368603 , 1.5202085675253332 , -66.47128275857952 ] ,
[ -0.10760597632151447 , 0.4447829733382794 , -78.26792577317356 ] ,
[ 1.4505912666410865 , 0.11181194755130709 , -91.59191648043213 ] ,
[ 0.9021523769749293 , 0.4885101990779564 , -105.14418627184878 ] ,
[ 0.9638175304161194 , 1.608509779583763 , -122.05442397404222 ] ,
[ 1.2491154299248495 , 0.9908933689171714 , -138.065949033425 ] ,
[ 1.352178306309604 , 0.5695955174343138 , -154.29319791205856 ] ,
[ -1.1461908559592386 , 0.536442601070842 , -172.46106105744252 ] ,
[ 0.17639228377784977 , 1.095990423220231 , -192.3291552196241 ] ,
[ 0.6827526940662969 , 0.49004407741172146 , -212.27299527013022 ] ,
[ -0.4620471505812016 , 1.547250038728946 , -231.91333886531353 ] ,
[ -0.44854561316344577 , 1.5419856109980128 , -255.48844328136352 ] ,
[ -0.7589242505005478 , 1.5376478278008237 , -276.5622833425785 ] ,
[ 0.6314567492238938 , 1.362393185879365 , -300.0942579341549 ] ,
[ 0.11830009273648656 , 1.705363629313127 , -326.5606031751497 ] ,
[ 1.2996201607842217 , 1.05644846945086 , -352.55939162702026 ] ,
[ -0.42049290848179155 , 1.5962537167364765 , -379.0991760400901 ] ,
[ 1.137453141882 , 0.7205915424156413 , -407.80029534799934 ] ,
[ -0.12501146168109156 , 1.793530600675613 , -435.9836058029906 ] ,
[ 1.0510579425250814 , 1.2601792424816372 , -466.0590966298221 ] ,
[ -0.6206298593544796 , 0.4656233806101532 , -497.81398065557164 ] ,
[ 0.9673186054032505 , 0.753536676365755 , -530.4045761151871 ] ,
[ -0.3580523318333536 , 0.7061506715222812 , -562.9584492578039 ] ,
[ -0.45866524565760547 , 0.37157195134350046 , -595.0852797040448 ] ,
[ 0.22540368354172413 , 0.5094972329572878 , -631.8062803492215 ] ,
[ -0.4751209125940421 , 1.6255161703071073 , -667.580926931215 ] ,
[ -0.11848388581415858 , 0.46709584416581645 , -704.3876636049675 ] ,
[ 1.1598646396828907 , 1.7207025386740291 , -740.9454427302941 ] ,
[ 0.0003393693345599136 , 0.24183202499083767 , -781.8597492277639 ] ,
[ -0.5979185431339096 , 1.4836639993969645 , -821.9617649687644 ] ,
[ 0.4328699853712916 , 1.159995114937352 , -861.4814206684588 ] ,
[ 0.5624813451712662 , 1.8676960456501108 , -904.0869774410102 ] ,
[ 0.5109926725909217 , 0.4784145456686223 , -946.0364780080754 ] ,
[ 0.39771502513477763 , 0.4627395956310899 , -992.2963502969308 ] ,
[ 0.9473824260750157 , 1.7941916478254647 , -1037.3680133873538 ] ,
[ 1.2740945622295368 , 1.460163740112957 , -1082.2293930110084 ] ,
[ -1.0645633191279162 , 0.42913344749157395 , -1128.5109922814815 ] ,
[ 0.7376117574357193 , 1.8019392328677704 , -1177.515743865585 ] ,
[ 0.02993669206084637 , 1.1381701127261619 , -1226.8419502266975 ] ,
[ 1.329739712222754 , 0.8659232013217507 , -1276.8224585822823 ] ,
[ -0.013745703302696644 , 0.957812491351652 , -1326.383976078163 ] ,
[ -0.3531987490735149 , 0.6724555301964549 , -1379.5122000773074 ] ,
[ -1.1546523821265315 , 0.22418754156750315 , -1432.6222399549786 ] ,
[ 1.344082535416587 , 0.592989704683141 , -1487.024075012307 ] ,
[ 1.0961231852192503 , 0.7339622858219108 , -1540.17744573929 ] ,
[ -0.18258404034373776 , 1.2049143839017988 , -1596.570857095274 ] ,
[ 0.8168741590147486 , 1.032004768336233 , -1653.3308492278045 ] ,
[ 0.8224020365543641 , 0.7814572515595796 , -1712.7533846684366 ] ,
[ -0.732021994639984 , 0.5716950227245716 , -1770.9414233745206 ] ,
[ 1.3354788562779716 , 0.1944128801166502 , -1829.9641274534695 ] ,
[ 0.12238182819548271 , 1.4085184355192493 , -1891.82682808272 ] ,
[ -0.7139507620913943 , 1.2630213246580069 , -1955.3307799490349 ] ,
[ 0.13114028661972466 , 1.8317592218187 , -2017.1808529870386 ] ,
[ 1.0112504347935853 , 1.8180466432538624 , -2081.275252050342 ] ,
[ 0.12841615743708013 , 0.06587914991333824 , -2145.0657376264908 ] ,
[ -1.0023017229066857 , 0.5644759949861826 , -2211.0065906296472 ] ,
[ 0.3821042526109679 , 1.3534012886395437 , -2278.9275125484933 ] ,
[ 0.7298392366296302 , 0.27307086326639257 , -2348.227086564242 ] ,
[ 0.11181445766540454 , 1.1894262961234865 , -2415.4246574484237 ] ,
[ 0.5141319349135338 , 0.19882876223766704 , -2485.3181874886154 ] ,
[ 0.22175671951253162 , 1.5273124892283527 , -2557.4295964665157 ] ,
[ -0.8985218852212894 , 0.3910905500319488 , -2628.4825021119227 ] ,
[ 1.443296588331792 , 0.07894411394822086 , -2701.76822259154 ] ,
[ -0.26444085232809367 , 0.624347913478317 , -2775.8517249483934 ] ,
[ -0.5672145127491633 , 0.6668149162608374 , -2851.9087427251734 ] ,
[ 0.18279615102742985 , 1.4946917557148796 , -2925.928928987441 ] ,
[ 1.476689221136403 , 1.863925476812451 , -3005.2178943923445 ] ,
[ 1.286687304391341 , 0.7761485939195306 , -3083.4610160265584 ] ,
[ -0.19867952891392915 , 1.3791080330242262 , -3161.4981122314152 ] ,
[ -0.7085653394458915 , 0.9169259873148669 , -3242.2003311837652 ] ,
[ -0.5974953367481526 , 0.26536861997116173 , -3323.169268847242 ] ,
[ 0.6565213215586532 , 0.10591111481842377 , -3404.537183535803 ] ,
[ 1.4217714366050374 , 0.06619175332128924 , -3488.42471862524 ] ,
[ -0.03152700868174563 , 1.841120047104393 , -3571.194806237819 ] ,
[ 0.04925956406421306 , 1.0510457587986524 , -3655.524318567013 ] ,
[ 1.4650214024111945 , 1.1652490645028082 , -3743.1152836701326 ] ,
[ -0.8312628639470889 , 1.892827497790065 , -3829.9223515752647 ] ,
[ -0.2043434895660099 , 0.532554104626882 , -3917.7000222400084 ] ,
[ 0.4046302943727864 , 1.2730431477491506 , -4005.1838920751165 ] ,
[ -0.20927775185206932 , 1.8014097537574525 , -4094.9241379950395 ] ,
[ -0.5889721043253563 , 0.5034880780657589 , -4186.966394277087 ] ,
[ 1.343109986175843 , 0.9515925176136794 , -4280.381448759935 ] ,
[ -0.10471478438187831 , 1.7865420975852304 , -4371.370018893578 ] ,
[ 0.6772183828050113 , 0.4562996591272469 , -4466.835129572298 ] ,
[ -0.9623909879127718 , 0.8829129709918606 , -4561.964871230161 ] ,
[ -0.6341284345693468 , 0.43313903052228236 , -4656.603335012946 ] ,
[ 0.46877743348815737 , 1.8792240537568503 , -4755.361395393426 ] ,
[ 0.36002359442680043 , 0.8860139531405736 , -4851.524665135151 ] ,
[ -0.4987569756517274 , 0.014416797102089906 , -4949.986075486162 ] ,
[ -0.2749146525638433 , 1.7384836854827388 , -5052.438348301218 ]])

sensor1_noise_cov = np.array([[0.29801201,0.0260134,0.03899557],
                              [0.0260134,0.1585327,0.03870672],
                              [0.03899557,0.03870672,0.61070139]])

sensor2_noise_cov = np.array([[ 0.5834703,0.00638922,-0.06083379],
                              [ 0.00638922,0.31987258,-0.02961871],
                              [-0.06083379,-0.02961871,0.64220555]]) 

len = 1#sensor1_fake_data.shape[0]

x_0 = np.array([0.0 , 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0])
u_0 = np.array([0.0 , 0, 0, 0 ])

sensor1_sensor_noise = np.zeros((3, 1))
sensor2_sensor_noise = np.zeros((3, 1))


kf = KalmanFilter()
drone = QuadrotorDynamics()

X = x_0
U = u_0
dt = 1/50

process_noise = np.zeros((1, 15))
P = np.zeros((15,15))
Q = np.zeros((15,15))

t_prev = -1
for i in range(len):
    t = i #time.time()
    # u = get_u() 
    A  = drone.getA(X)
    B = drone.getB(X)
    
    X, P = kf.apply_system_dynamics(X, A, B, U, Q, P, process_noise, t - t_prev)

    print(drone.getH(X,U))
    #X, P = kf.update_measurement(X,drone.getH(X,U),P,sensor1_fake_data[i],sensor1_sensor_noise,sensor1_noise_cov)
    # X, P = kf.update_measurement(X,drone.getH(X,U),P,sensor2_fake_data[i],sensor2_sensor_noise,sensor2_noise_cov)

    #print(X)
    t_prev = t
